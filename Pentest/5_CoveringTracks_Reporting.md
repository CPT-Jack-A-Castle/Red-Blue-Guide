# TABLE OF CONTENTS
1. [GENERAL](https://github.com/p-arrow/Red-Blue-Guide/blob/main/Pentest/5_CoveringTracks_Reporting.md#general)
2. [LINUX](https://github.com/p-arrow/Red-Blue-Guide/blob/main/Pentest/5_CoveringTracks_Reporting.md#linux)
3. [WINDOWS](https://github.com/p-arrow/Red-Blue-Guide/blob/main/Pentest/5_CoveringTracks_Reporting.md#windows)
4. [REPORTING](https://github.com/p-arrow/Red-Blue-Guide/blob/main/Pentest/5_CoveringTracks_Reporting.md#reporting)

<br />

# GENERAL
1. [FORENSIC LIFECYCLE](https://github.com/p-arrow/Red-Blue-Guide/blob/main/Pentest/5_CoveringTracks_Reporting.md#forensic-lifecycle)
2. [STEGANOGRAPHY](https://github.com/p-arrow/Red-Blue-Guide/blob/main/Pentest/5_CoveringTracks_Reporting.md#steganography)

<br />

## FORENSIC LIFECYCLE
## Info
### Forensic Work Cycle
1. Identification: Ensure safe scene & prevent evidence contamination
2. Collection: Ensure authorization to collect evidence
3. Analysis: Create copy of evidence, i.e. original -> image -> copy
4. Reporting: About methods, tools used and conclusions

**> Every step must follow written procedures (!)**

### Forensic Ethics
- Analysis must be performed without bias
- Analysis methods must be repeatable by third parties
- Evidence must not be changed/manipulated

**> Some attorneys use any deviation of ethics to dismiss your analysis (!)**

### Chain of Custody
- Record of evidence from collection to presentation in court
- Specialized evidence bags are used for electronic media
- Properly label all evidence

### Data Collection Procedures
1. Create forensic disk image of data (for law enforcement)
2. "Chain of custody" to document collection&preservation
3. Track man-hours and expenses
4. Capture evidence in the following order:
   1. CPU registers
   2. Cache
   3. RAM
   4. Routing table
   5. ARP
   6. Kernel
   7. Swap
   8. SSD
   9. HDD
   10. Screenshots/Videos

### Work Product Retention
- Attorney hires forensic analyst (two party contract), not the victim!
- Attorney decides if analysis can be disclosed to def./prosecution

### Forensic Workstations
- Must have multiple cores
- Lot of RAM (>64GB)
- Lot of SSD space or SAN
- Multi media reader (CD,DVD,Blueray,USB,SD Card etc)
- Is prohibited from accessing the internet (!)

### Forensic Tools
- EnCase: proprietary
- FTK (Forensic Toolkit): proprietary
- The Sleuth Kit: open-source
- Timeline: Shows sequence of file system events of image (GUI)
- Memdump
- dd (disc duplicate)
- Forensic Drive Duplicator: Copies drive and validates it matches the original drive
- Hardware Write Blocker: Ensure that Forensic Tools cannot change HDD/SSD
- Software Write Blocker

### Network Forensic Tools
- SPAN (Switched Port Analyzer): Copy NW traffic to another port
- Packet Sniffer: 
    - Record data from frames using mirrored port or tap device
    - Use Sniffer inside FW or close to an important server
- Wireshark (GUI)
- Tcpdump
- FPC (Full Packet Capture): Payload + Header (High Consumption!)
- Flow Collector: Record metadata/statistics about NW traffic 

<br />

## SANITIZATION
**Disposal of obsolete information/equipment (part of IR Eradication)**

## Info
### Cryptographic Erase (SSD/HDD)
- Used for storage media that is encrypted by default
- The encryption key itself is destroyed during the erasing operation

### Zero-fill (HDD)
- Overwriting all bits to Zero
- CMD: `format c: /fs:NTFS /p:1`
   - /p:1 = one set of zeros over c
- Zero-Fill is not sufficient for SSD's (!)
- Because device uses wear-leveling routines in the drive controller (!)
- To communicate which locations are available for use to any SW process accessing the device (!)

### Data Wiping
- 1x, 7x, or 35x overwriting
- The higher the number of times, the more secure

### Degausser (HDD)
- Demagnetizing a hard drive to erase its stored data
- Reuse of disk impossible (!)

### Shredding
- Physical destruction of disk

### Purging
- Removing sensitive data by using the device's own electronics
- Reuse of disk impossible (!)

<br />

## STEGANOGRAPHY
## Info
- [Wiki/Steganography](https://github.com/p-arrow/Red-Blue-Guide/blob/main/Wiki/Steganography.md)

<br />

# LINUX
1. [CLEAR TRACES (LINUX)](https://github.com/p-arrow/Red-Blue-Guide/blob/main/Pentest/5_CoveringTracks_Reporting.md#clear-traces-linux)

<br />

## CLEAR TRACES (LINUX)
## HowTo
- Command History (from all sessions): 
   - `home/user/.bash_history`
   - `root/.bash_history`
- How to clear logs:
   1. `export HISTSIZE=0` (clear command history)
   2. `history -c` (clear command history of active session)
   3. `nano /var/log/messages` ; CTL+6 & mark all & CTL-K (delete event logs)
   4. `shred -zu root/.bash_history` (overwrite file with zeros, deallocate and remove after overwriting)
   5. `dd if=/dev/zero of=/dev/sda` (overwrite hard disk with zeros)


<br />

# WINDOWS
1. [AMCACHE, PREFETCH AND SHIMCACHE](https://github.com/p-arrow/Red-Blue-Guide/blob/main/Pentest/5_CoveringTracks_Reporting.md#amcache-prefetch-and-shimcache)
2. [ALTERNATE DATA STREAMS](https://github.com/p-arrow/Red-Blue-Guide/blob/main/Pentest/5_CoveringTracks_Reporting.md#alternate-data-streams)
3. [CURVING](https://github.com/p-arrow/Red-Blue-Guide/blob/main/Pentest/5_CoveringTracks_Reporting.md#curving)
4. [CLEAR TRACES (WIN)](https://github.com/p-arrow/Red-Blue-Guide/blob/main/Pentest/5_CoveringTracks_Reporting.md#clear-traces-windows)
5. [FSUTIL USN](https://github.com/p-arrow/Red-Blue-Guide/blob/main/Pentest/5_CoveringTracks_Reporting.md#fsutil-usn)
6. [ICO CONVERTER](https://github.com/p-arrow/Red-Blue-Guide/blob/main/Pentest/5_CoveringTracks_Reporting.md#ico-converter)
7. [JUMPLISTS](https://github.com/p-arrow/Red-Blue-Guide/blob/main/Pentest/5_CoveringTracks_Reporting.md#jumplists)
8. [THUMBNAILS](https://github.com/p-arrow/Red-Blue-Guide/blob/main/Pentest/5_CoveringTracks_Reporting.md#thumbnails)

<br />

## AMCACHE, PREFETCH AND SHIMCACHE
## Info
### Prefetch file
- Stores data when application starts (date/time, DLLs, file path)
- Disabled by default on Windows Server platforms?!

### Shimcache (application compatibility cache)
- Created by Microsoft (Win XP) to track compatibility issues
- Helps troubleshoot legacy functions 
- Tracks metadata: full file path, last modified date, file size
- Current entries are stored only in Memory
- Only written to Registry when system is shutdown
   - Volatility Framework for LiveParsing!
- New Entries created when fileâ€™s metadata changed + re-executed
- `HKLM\SYSTEM\CurrentControlSet\Control\SessionManager\AppCompactCache`

### Amcache
- What: Application Usage Cache stored as hive file
- Where: `C:\WINDOWS\appcompat\Programs\Amcache.hve`
- About: execution path, first executed / deleted time, first installation
- Was called "RecentFileCache.bcf" (before Win7)

<br />

## ALTERNATE DATA STREAMS
## Info
- Meta data attached to another medium (text, picture etc.)
- Both GUI and CLI don't show ADS by default
- Size of carrier medium is not affected by ADS 
- Can be used to transport stealthy malicious code 
- Only available under Windows

## HowTo
1. Create text file: test.txt and fill in arbitrary data, save 
2. Create ADS via CMD: `notepad test.txt:secret.txt`, write arbitrary data into ADS file, save and close
3. CMD: `dir` (to display test.txt)
4. CMD: `dir /r` (to display test.txt and secret.txt)
5. Edit ADS: Enter in CLI `notepad test.txt:secret.txt`
6. Remove ADS: Copy carrier medium on FAT-Volume, because FAT cannot handle ADS

<br />

## CURVING
## Info
- Extracting data from computer when that data has no associated file system metadata

### Background
- HDD and SSD are divided into sectors
- 512 bytes (standard) or 4096 bytes (Advanced)
- Block is smallest unit a file system can address (default 4096 bytes)
- Thus big files are broken into sector-friendly pieces and stored

### MFT (Master File Table)
- Contains metadata with location of each file
- When deleting a file you delete the metadata/entry of this file
- But the file still exists!
- These files are marked as "free space", and could be overwritten
- When you need to recover deleted files: Stop using the computer to minimize overwriting risk

<br />

## CLEAR TRACES
## HowTo
1. via existing meterpreter session: `clearev` (clear event logs + "Log Clear" log appears)
2. via existing meterpreter session: `run event_manager -c Security` (clear security logs)
3. via existing meterpreter session: `migrate [pid]` (use pid of common process like explorer.exe)
4. download [clearlogs.exe](https://sourceforge.net/projects/clearlogs/) onto Windows machine + `run` (no "Log Clear" log pops up in Event Viewer)
5. CLI: `attrib +h +s payload.exe` (make payload as hidden system file)
6. Check out: [https://www.scriptjunkie.us/2011/05/system-kill/](https://www.scriptjunkie.us/2011/05/system-kill/) 
   - wipes MBR and Partition Table (!)
7. via existing meterpreter session: `use post/windows/kill` ; select session ; `run` (crashing the machine and wiping its traces)

<br />

## FSUTIL USN
## Info
1. Manages the **Unique Sequence Number (USN)** change journal
2. One journal for one disc volume
3. USN Change Journal provides persistent log of all file changes on volume
4. As files/dirs are modified, NTFS enters records into the USN Change Journal
5. Each record indicates the type of change and the object changed
6. New records are appended to the end of stream

## HowTo
- Open CMD
```
fsutil usn readjournal C: <option>
fsutil file queryFileNameById C:\ "0x" + <Data-ID>
```

<br />

## ICO CONVERTER
## Info
- Hide your payload inside a  picture, so called icon

## HowTo
1. Install winrar on your Win-machine for compression functionality
2. Select image.jpeg + payload and right-click "add to archive"
3. Choose SFX & best compression
4. Go to Advanced SFX Options: run payload firstly, image secondly; select Silent Mode: Hide All
5. Under Advanced SFX Options: Choose "Text and Icon" -> Load SFX icon from file
6. Under Advanced SFX Options: Choose "Update" -> Extract and update files ; Overwrite all files

<br />

## JUMPLISTS
## Info
### Characteristic
1. Located at **%USER%/%APPDATA%/Microsoft/Windows/Recent/**
2. Provide info about apps, docs, pics that user has interacted with
3. Generated even for files accessed from external devices
4. Remain intact, even original file is deleted or external device removed

### Content of Jumplists
1. File name
2. Computer name
3. MAC address
4. Path to the file being accessed
5. Application utilized to open the file
6. Access date and time

## THUMBNAILS
## Info
- Located at **%USERPROFILE%/AppData/Local/Microsoft/Windows/Explorer**
- Images can be recovered even if original image has been deleted
- Smaller version of pictures still exist in Windows Thumbnails
- Even deleted thumbnails could be restored via [file curving](https://github.com/p-arrow/Red-Blue-Guide/blob/main/Pentest/5_CoveringTracks_Reporting.md#curving)
- Windows Vista / 7 / 8 / 8.1 / 10 usually keep thumbnails here:

<br />

# REPORTING
## Info
### General Guideline
- Brief (omit bloating)
- Easy to Read (Avoid Abbreviations)
- Proofread (check spelling and grammar)
- Secure (encrypt your report)
- Definitive Statements (Avoid "I think", "Maybe", ...)

### Content 

#### 0) Basics
- Document Control
- Disclaimer
- Table of Contents
- Appendices

#### 1) Methodology
1. Type of Assessment
2. Tools
3. How to define Severity of Risks
4. Used Frameworks

#### 2) Scope
- Be Specific
- Be clear what is included
- Be clear what is excluded
- Note Primary Goals

#### 3) Executive Summary
*Highlight Key Points on one page*

1. Background
2. Overall Posture
3. Risk Ranking/Profile
4. General Findings
5. Recommendation Summary
6. Strategic Roadmap

#### 4) Findings and Recommendations
*Detailed Technical Report*

1. Introduction
2. Information Gathering (Passive/Active/Corporate/Personnel)
3. Vulnerability Assessment
4. Exploitation
5. Post-Exploitation
6. Risk-Exposure
7. Remediation Recommendations
8. Conclusion

