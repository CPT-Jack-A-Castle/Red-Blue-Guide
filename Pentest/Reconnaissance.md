# TABLE OF CONTENTS
1. [ARP](https://github.com/p-arrow/Red-Blue-Guide/blob/main/Pentest/Reconnaissance.md#arp)
2. [E-MAIL](https://github.com/p-arrow/Red-Blue-Guide/blob/main/Pentest/Reconnaissance.md#e-mail)
3. [NMAP](https://github.com/p-arrow/Red-Blue-Guide/blob/main/Pentest/Reconnaissance.md#nmap)
4. [OFFENSIVE OSINT](https://github.com/p-arrow/Red-Blue-Guide/blob/main/Pentest/Reconnaissance.md#offensive-osint)
5. [RECON_NG](https://github.com/p-arrow/Red-Blue-Guide/blob/main/Pentest/Reconnaissance.md#recon_ng)
6. [WEB APPLICATION](https://github.com/p-arrow/Red-Blue-Guide/blob/main/Pentest/Reconnaissance.md#web-application)

# ARP
## Info
*ARP = Address Resolution Protocol*

**ARP Attacks**
- Exploit IP-to-MAC resolution to steal/modify/redirect frames
- Allows MITM/DoS attacks

## HowTo
### ARP Scans
- Kali: `$ arp-scan --localnet`
- Windows: `arp -a` (show all arp-cache)

<br /> 

# E-MAIL
## Info
- Standard for ARPA (**A**dvanced **R**esearch **P**rojects **A**gency) Text Messages: [RFC 822](https://www.w3.org/Protocols/rfc822/)
- Email Parsing: [https://www.parsemail.org/](https://www.parsemail.org/)

<br /> 

# NMAP
## Info
Check out: [https://nmap.org/book/man-briefoptions.html](https://nmap.org/book/man-briefoptions.html)

## HowTo
### Common Commands
- `nmap` (scans 1,000 TCP ports on the target)
- `nmap -sn / -sP`  (only Host Discovery)
- `nmap -Pn` (no Host Discovery/Ping, only port scan)
- `nmap -p21,23,80` (explicit port selection)
- `nmap -p-` (all 65k ports)
- `nmap -v` (verbose)
- `nmap -6` (IPv6)
- `nmap -reason` (short explanation of host answer)
- `nmap -sI` (TCP-IDLE Scan via Zombie Host) --> investigate via IP-ID if port is open/closed
- `nmap -Pn -p- -sI [IPv4 Zombie] [IPv4 target]`
- `nmap -PU80,443` (UDP-Scan + explicit port selection)
- `nmap -PE` (ICMP type 8 = echo request)
- `nmap -PP` (ICMP type 14 = timestamp 
- `nmap -PM` (ICMP type 18 = address mask)
- `nmap -sA`  (ACK Paket (FW Walking possible!))
- `nmap -sV`  (Version identification)
- `nmap -sS` (SYN scan)
- `nmap -sU` (UDP scan)
- `nmap -sT`  (TCP scan) --> when -sS is no option due to missing raw socket access, i.e. no root access
- `nmap -O` (OS identification )
- `nmap -oX` (Output .xml; add "--webxml" as stylesheet reference)
- `nmap -T` (Scan time T0 [paranoid] - T5[insane])
    - **> Fast Speed can cause fragile devices to reboot/print random data (!)**


### NSE (Nmap Script Engine)
- Written in LUA script language
- Extended analysis of target system 
- Testing for vulns of certain exploits 
- NSE-Scripts verify host & service before execution (efficient) --> only suitable scripts are executed
- Scripts are stored here: `/usr/share/nmap/scripts`

**NSE Examples:**
```
- nmap -sC [IPv4] (-sC = --script=default)
- nmap --script [script1],[script2],... [IPv4] (explicit script selection)
- nmap --script http-waf-detect [IPv4]
- nmap --script HTTP-google-malware [IPv4] (query if IP is in Google DB)
- nmap localhost -p 31000-32000 -sV
- nmap -sV --script=vuln [IPv4]
- nmap -sV -p 22 --script ssh2-enum-algos [IPv4]
- nmap --script-help "*ms* and *sql*"
```

### Quick Scans
1. `nmap -F`: 100 Ports
2. `nmap --top-ports 10`: 10 top Ports scannen
3. `nmap --exclude-ports [Portnr, Portnr, ...]`
4. `nmap -sS -sU -p T:22,25,80,U:53,161 [IPv4]`

### Scanflags
- `nmap --scanflags [your own flag]`: 
    - sN: TCP Null (no flag)
    - sF: FIN
    - sX: Xmas (FIN, PSH, URG)

### Important Directories
- `/usr/share/nmap/nmap_payloads`: Which packets are sent during scan 
- `/usr/share/nmap/nmap_services`: port list with indicated chance of being "open" 
- `/usr/share/nmap/scripts`: Script list

### Firewall Evasion (If nmap is blocked)
1. ICMP Echo Request (Typ 8): `nmap -PE`
2. ICMP Timestamp Request (Typ 13): `nmap -PP`
3. TCP SYN Port 443:`nmap -PS443`
4. TCP ACK Port 80: `nmap -PA80`

### Firewall Avoidance
1. Fragmentation of sent packets: `nmap -f [IPv4] --top-ports 10`
2. Decoy Scan: `nmap -D [fakeIPv4],...,...,ownIP] [target IPv4]`
   - Place your own IP at sixth place
   - Some IDS don't show IPv4 anymore after several recognized port scans 
3. Usage of alternative sender address: `nmap -S [fakeIPv4]`
   - Only deception (at the expense of missing scan results)
4. SYN-Stealth-Scanning: Not stealthy anymore (!)

### TTL Reply
The output of a successful ping contains information about TTL (Time to Live)
- TTL 128: Normally Windows machine
- TTL 64: Normally Linux machine

![grafik](https://user-images.githubusercontent.com/84674087/133131598-45427a85-9b92-4221-af39-0e95bbcab638.png)


<br />

# OFFENSIVE OSINT
## Info
*Going after hackers and uncover their identities* (when organization is under attack)

### Best Practices
1) Out-of-band communication: Avoid regular communication channels
2) Fake social media profiles
3) Passive info gathering: Avoid tools that send your IP addr to target
4) Need-to-know: Do not tell anyone about analysis except IRT

<br />

# RECON_NG
## Info
- A framework that performs automatic reconnaissance for you!

## HowTo
### Example cisco.com
```
workspaces create cisco.com 
marketplace info [module] / marketplace install [module]
modules load [module]: info / options set [Name]
db insert domains cisco.com
```

### Example Modules
1) run google_site_web: show hosts
2) run recon/hosts-hosts/resolve: resolve IPv4 hosts
3) keys add ipinfodb <API key> ; modules load recon/hosts-hosts/ipinfodb
    - check IP location of target
    - register yourself to receive API keys
4) Module pocs: investigate Email addresses
5) Module reporting/html: create report
  
<br />

# WEB APPLICATION
## Info
- General Information: [Networks/Web Application](https://github.com/p-arrow/Red-Blue-Guide/blob/main/Networks/Web%20Application.md)
- Check out: [3_Exploitation/Web Application](https://github.com/p-arrow/Red-Blue-Guide/blob/main/3_Exploitation/Web%20Application.md)

### WebApplication Features
#### 1) Cache-Control
- **no-cache**:
   - It does not prevent data being cached locally
   - Forces validation of the cached content
   - Browser must check for new versions when the page is requested again
- **private**:
   - private does not prevent any caching by web browsers
- **no-store**
   - strongest and preferred directive for secure applications
   - no-store instructs browsers not to store the content locally
- **Pragma**: Serves for backwards compatibility with the HTTP/1.0 caches that do not have a Cache-Control HTTP/1.1 header [MDN](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Pragma)
- View cache on Firefox: `about:cache`

## HowTo 
- Below "General Start" is inpired by [Carlospolop](https://github.com/carlospolop/hacktricks/tree/master/pentesting)
- Aim to apply this methodology to each discovered domain, subdomain or IP with undetermined web server inside the scope

### General Start
- Start by preparing a "notebook" to keep track of all your findings (to not forget any findings and keeping an overview!)
   - [Cherrytree](https://github.com/giuspen/cherrytree)
   - [Mind Map](https://www.xmind.net/)
   - [Maltego](https://www.maltego.com/)
   - Simple Notepad
   - Excel
   - etc. 
- Identifying the **technologies** used by the web server
   - Check out main page with different extensions: home.html / home.asp / home.aspx / home.php
- Any **known vulnerability** of the version of the technology?
- Any **well known tech**?
- Any **useful trick** to extract more information?
   - Check out metadata of pictures with exiftool
- Any **specialized scanner** to run like wpscan?
- Any **general purpose scanner** to run? 
- Initial checks:
   - robots (www.example.com/robots.txt): allow/disallow search of web crawlers
   - sitemap
   - 404 error
   - SSL/TLS scan (if HTTPS)
- **Spider the web page** in order to find all possible files, folders and parameters being used
   - Anytime a new directory is discovered, it should be spidered
- **Directory Brute-Forcing**: Try to brute force all the discovered folders searching for new file and directories 
   - Anytime a new directory is discovered, it should be brute forced
- **Parameter Brute-Forcing**: Try to find hidden parameters
- Look out for backups of discovered files appending common backup extensions

**>> Once you have identified all the possible endpoints accepting user input, check for all kind of vulnerabilities related to it!**

### curl
```
curl example.com
curl --head example.com
curl -X GET example.com 
curl -X DELETE example.com/include/config.db
curl -X OPTIONS example.com --head (show available HTTP Methods)
curl -T file example.com 
curl -O example.com/file 
curl -u username:password http://
```
- `-X` = --request
- `-T` = upload file
- `-O` = write output to file named like remote file
- `-u` = --user

### dirb: Web Content Scanner
- old and slow!
- `dirb http://example.com/`

### dirbuster
- ...

### dig
```
dig @server example.com [DNS record type]
dig example.com mx
dig axfr @NS example.com (Exp: @NS = @ns1112.ui-dns.org)
dig axfr @nsztm1.digi.ninja zonetransfer.me (for educational purpose)
```

*Checkout: [Z_Networks/DNS](https://github.com/p-arrow/Red-Blue-Guide/blob/main/Z_Networks/DNS.md)*

### ffuf
- fast fuzzing U fool
- `ffuf -c -w /usr/share/wordlists/dirb/big.txt -u http://10.10.10.10/FUZZ`

### gobuster
```
- gobuster dir -u http://192.168.0.155/ -w /usr/share/wordlists/dirb/common.txt
- gobuster -m dns -t 100 -u google.com -w /usr/share/wordlists/metasploit/namelist.txt
```
- t = number of concurrent threads
- m = method
- q = quit
- o = output


### nikto
- `nikto -host example.com`

### whatweb
- ...

### wpscan
```
wpscan –url http://example.com –enumerate u (users)
wpscan --usernames 'wpusers' --passwords 'pass' --url http://sbva.local/blog/
```

### red_hawk
- All in one web scan tool
- `git clone https://github.com/Tuhinshubhra/RED_HAWK.git`

<br />

