# RedTeam

## Build

- From binary to
    - Machine code (via hexdump)
    - Assembly Code (via Disassembler)
    - Source Code/High-Level Code (via Decompiler)

## JMP ESP (Jump Stack Pointer)

*How is "JMP ESP" presented in Assembler and Opcode?*

1. JMP ESP ( \xFF\xE4)
2. CALL ESP ( \xFF\xD4)
3. PUSH ESP; RET (\x54\xC3)

**Automatic Search for JMP ESP within example.exe**

1. Move to Metasploit-Framework directory
    - `cd /usr/share/metasploit-framework/modules`
2. Enter `./msfpescan -j ESP [example.exe]`

## File Signature/Magic Number

*First two bytes of binary header*

- Windows executable: 4D 5A
    - Exp: EXE | DLL | SYS | DRV | COM 
- ASCII:  MZ
- Base64: TV
- ELF: 7f 45 4c 46
- INDX ($I30): 49 4E 44 58

## Tools

1. ltrace
    - Analyze library calls of an application
    - `ltrace -p [pid]`: Attach ltrace to running app with known process id
2. strace
    - Analyze system calls of an application
    - `strace -p [pid]`: Attach strace to running app with known process id

## Assembler Code

#### Syntax
1. AT&T
    - Source before Destination
    - Parameter size is indicated by last char
    - Exp: `addl $4, %esp`
2. Intel
    - Destination before Source
    - Parameter size defined by register name
    - Exp: `add esp, 4`

#### Register and Flags

Parameter | Explanation
--------- |------------
edx | Data
edi | Destination Index
esi | Source Index
ebp | Base Pointer
esp | Stack Pointer
eip | Instruction Pointer 
CF | Carry Flag
PF | Parity Flag
ZF | Zero Flag
SF | Sign Flag
OF | Overflow Flag
IF | Interrupt Enable Flag

#### Terms
- LWord (LongWord) = 16 Bit
- DWord (DoubleWord) = 32 Bit
- QWord (QuadWord) = 64 Bit
- .cfi (call frame information pointer): points to previous frame
- .cfa: canonical frame address
- PIE (Position Independent Executable): for ASLR
- PIC (Position Independent Code)
- PLT (Procedure Linkage Table): Table with called functions from other modules
- LFB (Local Function Begin)
- LFE (Local Function End)
- ld (Linux Loader):
    - `/usr/bin/ld`
    - link c++ file/libraries manually together
    - Normally this is done automatically via g++

#### Calling Convention
> Set rules on how arguments are passed to function and how values are returned from function. Herein "Caller" calls a function and "Callee"is called by a function.

**Windows C-Applications**
1. cdecl (default for C/C++ programms)
    - Passing order: Right to left
    - How: The calling function pops the arguments from the stack
    - Stack Cleanup: Caller
    - Compiler Option: /Gd

2. stdcall (default for Win32 API)
    - Passing order: Right to left
    - How: The called function pops its own arguments from the stack
    - Stack Cleanup: Callee
    - Compiler Option: /Gz



<br />

# BlueTeam

## Best Practice
Attackers need information about information control flow of an application in order to manipulate memory access and registers. Consequently, defenders have to prevent attackers from performing static code analysis
